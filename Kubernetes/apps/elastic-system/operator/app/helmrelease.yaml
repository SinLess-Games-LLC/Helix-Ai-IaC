---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: elastic-operator
  namespace: elastic-system
spec:
  interval: 30m
  chart:
    spec:
      chart: eck-operator
      version: 2.11.0
      sourceRef:
        kind: HelmRepository
        name: elastic
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    installCRDs: true
    replicaCount: 1

    serviceAccount:
      # create specifies whether a service account should be created for the operator.
      create: true
      # annotations to add to the service account
      annotations: {}
      # name of the service account to use. If not set and create is true, a name is generated using the fullname template.
      name: "elastic-admin"

    tracing:
      # enabled specifies whether APM tracing is enabled for the operator.
      enabled: true
      # config is a map of APM Server configuration variables that should be set in the environment.
      config:
        ELASTIC_APM_SERVER_URL: http://localhost:8200
        ELASTIC_APM_SERVER_TIMEOUT: 30s

    webhook:
      # enabled determines whether the webhook is installed.
      enabled: true 
      certManagerCert: elastic-webhook-cert

    telemetry:
      # disabled determines whether the operator periodically updates ECK telemetry data for Kibana to consume.
      disabled: false
    
    podMonitor:
      # enabled determines whether a podMonitor should deployed to scrape the eck metrics.
      # This requires the prometheus operator and the config.metricsPort not to be 0
      enabled: true
      namespace: monitoring

